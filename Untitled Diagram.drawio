<mxfile host="app.diagrams.net" modified="2021-09-10T13:31:31.000Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1 Safari/605.1.15" etag="3etyW2P-YwEp26MT6Oix" version="15.1.4" type="github">
  <diagram id="TH07ysKGJmiZBzvDwPMG" name="Page-1">
    <mxGraphModel dx="830" dy="618" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-1" value="" style="whiteSpace=wrap;html=1;aspect=fixed;" vertex="1" parent="1">
          <mxGeometry x="30" y="90" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-2" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="420" y="90" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-3" value="mongoldb&lt;br&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="415" y="180" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-4" value="id userid &amp;nbsp;&lt;span style=&quot;color: rgba(13 , 27 , 62 , 0.65) ; font-family: &amp;#34;monospaced number&amp;#34; , &amp;#34;chinese quote&amp;#34; , , , &amp;#34;segoe ui&amp;#34; , &amp;#34;roboto&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;helvetica neue&amp;#34; , &amp;#34;helvetica&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif ; font-size: 13px ; text-align: left ; background-color: rgb(240 , 251 , 255)&quot;&gt;soundUrl &amp;nbsp;created&lt;/span&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="75" width="270" height="110" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-5" value="剩余次数 存入 redis&amp;nbsp;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="215" y="250" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-6" value="" style="shape=singleArrow;whiteSpace=wrap;html=1;arrowWidth=0.4;arrowSize=0.4;" vertex="1" parent="1">
          <mxGeometry x="140" y="100" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-7" value="1.获取用户 Id&lt;br&gt;2.上传文件到 oss&lt;br&gt;3.获取 url&lt;br&gt;4.构建 pojo&amp;nbsp;&lt;br&gt;5.调用 api 存入 数据库&lt;br&gt;" style="whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="220" y="80" width="150" height="100" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-8" value="controller" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="30" y="70" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-9" value="controller" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="40" y="320" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-11" value="接收语音&lt;br&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="30" y="300" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-12" value="一共10 次 12点重置" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="90" y="270" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-13" value="发送语音" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="30" y="30" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-14" value="oss 存储 数据存入 MongoDB" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="140" y="30" width="170" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-15" value="字段" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="500" y="50" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-16" value="" style="shape=singleArrow;whiteSpace=wrap;html=1;arrowWidth=0.4;arrowSize=0.4;" vertex="1" parent="1">
          <mxGeometry x="140" y="360" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-17" value="1.获取用户 id&lt;br&gt;2.构建 redis key 获取&lt;br&gt;获取 redis 非空判断&lt;br&gt;为空 第一次 次数设置为 10&lt;br&gt;不为空 大于0 判断&lt;br&gt;大于 0 次数减一设置回 redis&lt;br&gt;调用 api 获取 推荐 语音 得到 推荐语音的 userId&lt;br&gt;根据 UserId 调用 api 获取 语音Url&lt;br&gt;根据 UserId 调用 UserInfoApi 获取用户信息&lt;br&gt;构建 vo 返回" style="whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="250" y="310" width="230" height="200" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-18" value="" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry y="350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-19" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="525" y="400" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-20" value="MongoDB&lt;br&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="520" y="480" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-21" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="530" y="510" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-22" value="mysql" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="535" y="600" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-23" value="获取用户信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="605" y="530" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-24" value="获取 音频 地址" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="605" y="420" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-25" value="推送 语音" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="10" y="240" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-27" value="" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
          <mxGeometry x="525" y="260" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-28" value="MongoDB&lt;br&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="520" y="350" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-29" value="推荐语音表（伪数据 后期大数据处理" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="585" y="270" width="210" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-30" value="构建 vo 返回&amp;nbsp;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="260" y="555" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-31" value="service" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="250" y="280" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-32" value="id userId toUserId &amp;nbsp;created" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="610" y="290" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-33" value="字段" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="590" y="250" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-34" value="如何重置？" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry y="480" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-35" value="定时任务&amp;nbsp;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="50" y="510" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-36" value="set keys = redisTemplate.keys(&quot;sound&quot; + &quot;*&quot;);&lt;br&gt;redisTemplate.delete(keys);" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="50" y="535" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-37" value="剩余次数 存入 redis&amp;nbsp;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="10" y="575" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-38" value="sound_userId&lt;br&gt;&amp;nbsp;第一次看 剩余次数 &amp;nbsp;10 次&lt;br&gt;每次都减一 重新设置 redis" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="20" y="605" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-40" value="query.skip(次数）&lt;br&gt;时间降序" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="635" y="375" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-41" value="获取一条语音" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="610" y="360" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-42" value="根据 userId 获取 音频地址 返回" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="590" y="440" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-43" value="service" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="220" y="60" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VL3w3KNL5hCD0TS1L97Q-44" value="不使用推荐用户表 推荐用户的id 可能没有语音 另外开一个推荐语音表" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="410" y="220" width="380" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
